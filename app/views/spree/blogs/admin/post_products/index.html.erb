<%= render :partial => 'spree/blogs/admin/shared/post_tabs', :locals => {:current => "Related Products"} %>

<% content_for :page_title do %>
  - Related Products
<% end %>

  <div id="add-line-item">
    <fieldset>
      <legend><%= t('.add_related_product') %></legend>
      <%= simple_form_for(Spree::PostProduct.new, url: admin_post_products_path) do |f| %>
        <%= f.association :product, input_html: { class: 'fullwidth' } %>
        <%= f.submit 'Add related product' %>
      <% end %>
    </fieldset>
  </div>

  <div id="products-table-wrapper">
    <%= render :partial => "related_products_table", :locals => { :post => @post } %>
  </div>

  <% content_for :head do %>
    <%= csrf_meta_tag %>
    <%= javascript_tag "var expand_variants = false;" %>

    <script type="text/javascript">

      jQuery(document).ready(function(){

        $("#add_product_name").product_autocomplete();

        $("#add_related_product").live("click", function(){
          if($('#add_variant_id').val() == ''){ return false; }
          jQuery.ajax({ url: this.href, type: "POST",
              data: { 'variant_id' : $('#add_variant_id').val() },
              success: function(data){
                $('#products-table-wrapper').html(data);
                $('#add_product_name').val('');
                $('#add_variant_id').val('');
              }
          });
          return false;
        });


      });
    </script>
  <% end %>
